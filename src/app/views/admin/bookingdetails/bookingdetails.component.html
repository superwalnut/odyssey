<div class="container">
    <div class="row">
      <div class="col-md-12 mx-auto">
        <div class="card">
          <div class="card-body p-4">
            <h2>{{booking?.weekDay}} 
            {{booking?.eventStartDateTime.toDate() |  date: "EE dd/MM/yyyy"}}</h2>
            <h3>
              <button mat-icon-button color="primary" (click)="toggleLockStatus()">
                <mat-icon>{{ booking?.isLocked ? 'lock': 'lock_open'}}</mat-icon>
              </button>

              <button mat-icon-button color="primary">
                <mat-icon>print</mat-icon>
              </button>
            </h3>


            <section title="Add new booking">
              <form>
                <mat-form-field>
                  <mat-label>Search player name</mat-label>
                  <input type="text" matInput [formControl]="myControl" [matAutocomplete]="auto">
                  <mat-autocomplete #auto="matAutocomplete">
                    <mat-option *ngFor="let user of filteredUsers | async" [value]="user">{{user}}</mat-option>
                  </mat-autocomplete>
                </mat-form-field>

                <mat-form-field appearance="fill">
                  <mat-label>Payment method</mat-label>
                  <mat-select (selectionChange)="selectedValue($event)" >
                    <mat-option *ngFor="let method of paymentMethods" [value]="method">
                      {{method}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <button mat-raised-button color="primary" (click)="createBooking(myControl)">Add</button>

                <!-- <button mat-raised-button color="primary" (click)="createBooking(myControl, myControl2)">Add</button> -->
              </form>
            </section>

            <table class="table table-sm">
              <thead>
                <tr>
                  <th scope="col">User</th>
                  <th scope="col">Payment</th>
                  <th scope="col">Amount</th>
                  <th scope="col">On</th>
                  <th scope="col"></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let p of allLocalBookingUsers; let i=index" >
                  <td scope="row">{{ i+1 }} {{p.name}} {{p.isForSale}}<i class="cil-description" *ngIf="p.note" title="{{p.note}}"></i></td>
                  <td scope="row"><i class="{{getPaymentClass(p.paymentMethod)}}"></i></td>
                  <td scope="row">{{ p.amount | currency}}</td>
                  <td scope="row">{{p.createdOn.toDate() | date: "dd/MM/yyyy hh:MM"}}</td>
                  <td>
                    <button mat-icon-button color="accent" title="withdraw" (click)="withdrawBooking(p)">
                      <mat-icon>remove</mat-icon>
                    </button> 

                    <button mat-icon-button color="accent" title="add notes" (click)="addNoteClicked(p)">
                      <mat-icon>add_comment</mat-icon>
                    </button> 
                </tr>
                <tr>
                  <th scope="row">Total {{total | currency}}</th>
                  <td colspan="4">Credit: {{totalCredit | currency}} Cash: {{totalCash | currency}} </td>
                </tr>
              </tbody>
            </table>

            <h3>Booking adjustment</h3>
            <table class="table">
              <thead>
                <tr>
                  <th scope="col">Amount</th>
                  <th scope="col">Note</th>
                  <th scope="col">Made by</th>
                  <th scope="col">Made on</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let t of groupTransactionsAdjusted">
                  <td>{{ t.amount | currency}}</td>
                  <td>{{ t.notes}}</td>
                  <td>{{ t.createdByDisplayName }}</td>
                  <td>{{ t.created.toDate() | date: 'dd/MM/yyyy HH:mm'}}</td>
                </tr>
              </tbody>
            </table>

            <form [formGroup]="adjustForm" (ngSubmit)="onSubmit()">
              <mat-form-field>
                <mat-label>Adjusted amount</mat-label>
                <input matInput placeholder="amount" formControlName="adjustAmount" type="number" required />
              </mat-form-field>
        
              <mat-form-field>
                <mat-label>Description</mat-label>
                <input matInput placeholder="description" formControlName="adjustDesc" required/>
              </mat-form-field>
              <button mat-raised-button color="primary" [disabled]="adjustForm.invalid">Save</button>
            </form>



          </div>
        </div>
    
      </div>
    </div>
    
    
</div>
    